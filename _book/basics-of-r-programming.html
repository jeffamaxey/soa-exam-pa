<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 1 Basics of R Programming | Society of Actuaries Exam PA</title>
<meta name="author" content="Jeff A. Maxey">
<meta name="description" content="1.1 Data Types in R  1.1.1 Exercise 1.2.2 - Calculating least squares estimates by matrix manipulation You are fitting a multiple linear regression model: \[ \begin{equation} \widehat{Y} =...">
<meta name="generator" content="bookdown 0.40 with bs4_book()">
<meta property="og:title" content="Chapter 1 Basics of R Programming | Society of Actuaries Exam PA">
<meta property="og:type" content="book">
<meta property="og:description" content="1.1 Data Types in R  1.1.1 Exercise 1.2.2 - Calculating least squares estimates by matrix manipulation You are fitting a multiple linear regression model: \[ \begin{equation} \widehat{Y} =...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 1 Basics of R Programming | Society of Actuaries Exam PA">
<meta name="twitter:description" content="1.1 Data Types in R  1.1.1 Exercise 1.2.2 - Calculating least squares estimates by matrix manipulation You are fitting a multiple linear regression model: \[ \begin{equation} \widehat{Y} =...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Society of Actuaries Exam PA</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html">Introduction</a></li>
<li class="book-part">A Crash Course in R</li>
<li><a class="active" href="basics-of-r-programming.html"><span class="header-section-number">1</span> Basics of R Programming</a></li>
<li><a class="" href="data-exploration-and-visualization.html"><span class="header-section-number">2</span> Data Exploration and Visualization</a></li>
<li class="book-part">Theory of and Case Studies in Predictive Analytics</li>
<li><a class="" href="linear-models.html"><span class="header-section-number">3</span> Linear Models</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="basics-of-r-programming" class="section level1" number="1">
<h1>
<span class="header-section-number">1</span> Basics of R Programming<a class="anchor" aria-label="anchor" href="#basics-of-r-programming"><i class="fas fa-link"></i></a>
</h1>
<div id="data-types-in-r" class="section level2" number="1.1">
<h2>
<span class="header-section-number">1.1</span> Data Types in R<a class="anchor" aria-label="anchor" href="#data-types-in-r"><i class="fas fa-link"></i></a>
</h2>
<div id="exercise-1.2.2---calculating-least-squares-estimates-by-matrix-manipulation" class="section level3" number="1.1.1">
<h3>
<span class="header-section-number">1.1.1</span> Exercise 1.2.2 - Calculating least squares estimates by matrix manipulation<a class="anchor" aria-label="anchor" href="#exercise-1.2.2---calculating-least-squares-estimates-by-matrix-manipulation"><i class="fas fa-link"></i></a>
</h3>
<p>You are fitting a multiple linear regression model:</p>
<p><span class="math display">\[
\begin{equation}
\widehat{Y} = \beta_{0} + \beta_{1}X_{1} + \beta_{2}X_{2} + \epsilon
\end{equation}
\]</span></p>
<p>to the following dataset:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>i</th>
<th><span class="math inline">\(Y_{i}\)</span></th>
<th><span class="math inline">\(X_{i1}\)</span></th>
<th><span class="math display">\[X_{i2}\]</span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>14</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="even">
<td>2</td>
<td>11</td>
<td>3</td>
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>14</td>
<td>0</td>
<td>6</td>
</tr>
<tr class="even">
<td>4</td>
<td>18</td>
<td>8</td>
<td>4</td>
</tr>
<tr class="odd">
<td>5</td>
<td>12</td>
<td>4</td>
<td>3</td>
</tr>
<tr class="even">
<td>6</td>
<td>9</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table></div>
<p>Perform the following two tasks in R:</p>
<p><strong>(a)</strong> In matrix form, the model is</p>
<p><span class="math display">\[
  \begin{equation}
  Y = X\beta + \epsilon
  \end{equation}
  \]</span></p>
<p>Set up the response vector <strong>Y</strong> and design matrix <strong>X</strong> corresponding to the dataset above.</p>
<p><strong>(b)</strong> Use the matrix formula <span class="math display">\[\widehat{\beta} = (X^TX)^{-1}X^TY\]</span> from Exam SRM to calculate the least squares estimates of <span class="math inline">\(\beta_{0}\)</span>, <span class="math inline">\(\beta_{1}\)</span>, <span class="math inline">\(\beta_{2}\)</span>.</p>
<p><strong>Solution:</strong> The R commands are collected below. Let’s look at the code line by line.</p>
<p><strong>(a)</strong> The response vector can be created by the following command:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">11</span>, <span class="fl">14</span>, <span class="fl">18</span>, <span class="fl">12</span>, <span class="fl">9</span><span class="op">)</span></span></code></pre></div>
<p>To setup the design matrix, we first create the three columns:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span> <span class="co"># same as c(1, 1, 1, 1, 1, 1)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The first column is a vectorof 1’s corresponding to the intercept of the model. It is created by the <code>rep(x, n)</code> function, which, in its simplest form, repeats or replicates the x vector n times.</p>
<p>The other two columns represent the values of <span class="math inline">\(X_{1}\)</span> and <span class="math inline">\(X_{2}\)</span>.</p>
<p>Now we combine these three vectors via c(x0, x1, x2) and use the <code><a href="https://rdrr.io/r/base/matrix.html">matrix()</a></code> function to produce the design matrix.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">X</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]    1    2    4</span></span>
<span><span class="co">#&gt; [2,]    1    3    2</span></span>
<span><span class="co">#&gt; [3,]    1    0    6</span></span>
<span><span class="co">#&gt; [4,]    1    8    4</span></span>
<span><span class="co">#&gt; [5,]    1    4    3</span></span>
<span><span class="co">#&gt; [6,]    1    1    2</span></span></code></pre></div>
<p><strong>(b)</strong> Using the matrix formula <span class="math inline">\(\widehat{\beta} = (X^TX)^{-1}X^TY\)</span>, we can calculate the least squares estimates of <span class="math inline">\(\beta_{0}\)</span>, <span class="math inline">\(\beta_{1}\)</span>, <span class="math inline">\(\beta_{2}\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">Y</span></span>
<span><span class="va">B</span></span>
<span><span class="co">#&gt;        [,1]</span></span>
<span><span class="co">#&gt; [1,] 5.2506</span></span>
<span><span class="co">#&gt; [2,] 0.8137</span></span>
<span><span class="co">#&gt; [3,] 1.5166</span></span></code></pre></div>
<p>Then <span class="math inline">\(\widehat{\beta}_{0}\)</span> = 5.2505543, <span class="math inline">\(\widehat{\beta}_{1}\)</span> = 0.8137472, and <span class="math inline">\(\widehat{\beta}_{2}\)</span> = 1.5166297.</p>
<p><em>Remark:</em> In Chapter 3, we will learn how to use the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function to fit a linear model and the <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code> function to extract the least squares estimates.</p>
</div>
<div id="data-frames" class="section level3" number="1.1.2">
<h3>
<span class="header-section-number">1.1.2</span> Data Frames<a class="anchor" aria-label="anchor" href="#data-frames"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Importance of Data Frames:</strong> In Exam PA (and predictive modeling in general), data frames are <strong>useful</strong> mainly for two reasons:</p>
<ol style="list-style-type: decimal">
<li><p><strong><em>(Data frames = datasets)</em></strong> From a statistical point of view, eac column of a data frame can be interpreted as observed values of the same variable (that’s why each column must have the same type of data) and each row represents the set of measurements taken for the same observations (e.g., record, case, instance) corresponding to these variables, very much like an Excel Spreadsheet. The variables across different columns are allowed to be of different types and capture different kinds of information.</p></li>
<li><p><strong><em>(Structure vs. Unstructured Data)</em></strong> From a data management prespective, data frames are efficient storage devices for <strong><em>structrued data</em></strong>, or data that fit into a tabular arrangement. The row-by-column configuration of structured data makes it easy to search for, extract, and compare information across rows, but there is a limit to the scope of information that can be expressed by structured data. It does not lend itself to information that does not naturally fit into a tabular arrangement. Such information, such as texts, images, audio, and videos, is known as <strong><em>unstructured data</em></strong>. Although unstructured data are more flexible and potentially useful, they are harder to access and have to be carefully pre-processed (or manipulated) before they can serve as useful inputs to a predictive model.</p></li>
</ol>
</div>
<div id="exercise-1.2.3---listing-the-components-of-a-list" class="section level3" number="1.1.3">
<h3>
<span class="header-section-number">1.1.3</span> Exercise 1.2.3 - Listing the components of a list<a class="anchor" aria-label="anchor" href="#exercise-1.2.3---listing-the-components-of-a-list"><i class="fas fa-link"></i></a>
</h3>
<p>In Exercise 1.2.2, we considered a multiple linear regression model for Y on two predictors <span class="math inline">\(X_{1}\)</span> and <span class="math inline">\(X_{2}\)</span>. As we will learn in Chapter 3, we can easily fit such a model by the following commands involving the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">11</span>, <span class="fl">14</span>, <span class="fl">18</span>, <span class="fl">12</span>, <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span><span class="op">)</span></span></code></pre></div>
<p>The resulting object, named <code>m</code>, is a list with various components.</p>
<p>List the components of <code>m</code> and choose the components that apears to contain the least squares coefficient estimates. Check your answers against the code.</p>
<p><strong><em>Solution:</em></strong> We can see a list of components of <code>m</code> by typing the command <code>m$</code>. Then RSudio will show a prompt listing all of the components of <code>m</code>.</p>
<p>Alternatively and more formally, we can apply the <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> function to <code>m</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "coefficients"  "residuals"     "effects"      </span></span>
<span><span class="co">#&gt;  [4] "rank"          "fitted.values" "assign"       </span></span>
<span><span class="co">#&gt;  [7] "qr"            "df.residual"   "xlevels"      </span></span>
<span><span class="co">#&gt; [10] "call"          "terms"         "model"</span></span></code></pre></div>
<p>Out of the 12 components, the <code>coefficients</code> component appears the most relevant. Accessing this component indeed produces the least squares coefficient estimates:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">$</span><span class="va">coefficients</span></span>
<span><span class="co">#&gt; (Intercept)          X1          X2 </span></span>
<span><span class="co">#&gt;      5.2506      0.8137      1.5166</span></span></code></pre></div>
</div>
<div id="functions" class="section level3" number="1.1.4">
<h3>
<span class="header-section-number">1.1.4</span> Functions<a class="anchor" aria-label="anchor" href="#functions"><i class="fas fa-link"></i></a>
</h3>
<p>The basic structure of a function in R:</p>
<pre><code>FUNCTION_NAME &lt;- function(ARGUMENT_1, ARGUMENT_2,...) {
  STATEMENT_1
  STATEMENT_2
  ...
  return(VALUE)
}</code></pre>
<p>Example of a function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sumDiff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">-</span> <span class="va">y</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sum<span class="op">=</span><span class="va">s</span>, diff<span class="op">=</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">sumDiff</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="va">sum</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="fu">sumDiff</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="va">diff</span></span>
<span><span class="co">#&gt; [1] -1</span></span>
<span><span class="fu">sumDiff</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; $sum</span></span>
<span><span class="co">#&gt; [1] 2 4 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $diff</span></span>
<span><span class="co">#&gt; [1] 0 0 0</span></span></code></pre></div>
</div>
</div>
<div id="basic-data-management" class="section level2" number="1.2">
<h2>
<span class="header-section-number">1.2</span> Basic Data Management<a class="anchor" aria-label="anchor" href="#basic-data-management"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have a basic undertanding of common data types and structures in R, we are ready to look at some elementary data management problems commonly encountered in Exam PA (you will see more complicated ones in ATPA). Even after we have imported the data into R in the usual observation-by-variable format, there are often data management issues that should be resolved before a predictive model can be constructed meaningfully. To illustrate these data mangement issues, we will focus on a small-scale dataset involving eight actuaries in a hypothetical company set up in the code below:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span></span>
<span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Embryo Luo"</span>, <span class="st">""</span>, <span class="st">"Peter Smith"</span>, <span class="cn">NA</span>, <span class="st">"Angela Peterson"</span>, <span class="st">"Emily Johnston"</span>, <span class="st">"Barbara Scott"</span>, <span class="st">"Benjamin Eng"</span><span class="op">)</span></span>
<span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"F"</span>, <span class="st">"F"</span>, <span class="st">"?"</span>, <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">25</span>, <span class="fl">22</span>, <span class="fl">50</span>, <span class="fl">30</span>, <span class="fl">42</span>, <span class="fl">29</span>, <span class="fl">36</span><span class="op">)</span></span>
<span><span class="va">exams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">Q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="cn">NA</span>, <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">8</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">Q2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">9</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">9</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">Q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span> ,<span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">salary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">300000</span>, <span class="cn">NA</span>, <span class="fl">80000</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">actuary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span>, <span class="va">gender</span>, <span class="va">age</span>, <span class="va">exams</span>, <span class="va">Q1</span>, <span class="va">Q2</span>, <span class="va">Q3</span>, <span class="va">salary</span><span class="op">)</span></span>
<span><span class="va">actuary</span></span>
<span><span class="co">#&gt;   x            name gender age exams Q1 Q2 Q3 salary</span></span>
<span><span class="co">#&gt; 1 1      Embryo Luo      M  -1    10 10  9  9  3e+05</span></span>
<span><span class="co">#&gt; 2 2                      F  25     3 NA  9  7     NA</span></span>
<span><span class="co">#&gt; 3 3     Peter Smith      M  22     0  4  5  5  8e+04</span></span>
<span><span class="co">#&gt; 4 4            &lt;NA&gt;      F  50     4  7  7  8     NA</span></span>
<span><span class="co">#&gt; 5 5 Angela Peterson      F  30     6  8  8 10     NA</span></span>
<span><span class="co">#&gt; 6 6  Emily Johnston      F  42     7  9 10 10     NA</span></span>
<span><span class="co">#&gt; 7 7   Barbara Scott      ?  29     5  8  9  7     NA</span></span>
<span><span class="co">#&gt; 8 8    Benjamin Eng      M  36     9  7  8  8     NA</span></span></code></pre></div>
<p>Each row of the dataset, called <code>actuary</code>, has information about an actuary’s name, gender, age, number of exams passed, three evaluation ratings on a scale from 1 to 10 assigned by their supervisors according to three performance measures, and their salary.</p>
<p>Although the dataset you will encounter in real life is likely to have hundreds and thousands of observations, for demonstration pruposes I have deliberately chosen a toy dataset like <code>actuary</code> so that you can appreciate the changes you have made to the dataset by visual inspection (the small size of the dataset makes this possible). The data management techniques we are going to illustrate, however, are so general and efficient that they apply equally well to large datasets.</p>
<p>Using this toy dataset, we will demonstrate how to accomplish the following data management tasks in R:</p>
<ol style="list-style-type: decimal">
<li><p><strong>(Deletion):</strong> How to delete the variable x, which is simply a column of row numbers and not useful for most predictive purposes?</p></li>
<li><p><strong>(Missing/abnormal values):</strong> Some entries in the dataset are missing or do not make sense. How to deal with these missing or abnormal entries?</p></li>
<li><p><strong>(Creation + Sorting):</strong> How to create a new numeric variable that averages the three evaluation ratings and provides an overall performance measure for each actuary? Based on the overall performance measure, which actuary has the best performance?</p></li>
<li><p><strong>(Identification):</strong> How to identify Associates (those who have passed 7 to 9 exams) and Fellows (those who have passed 10 exams)? More generally, how to create a new categorical variables that represents whether an actuary is an Associate, Fellow, or pre-ASA student?</p></li>
<li><p><strong>(Merge):</strong> How to add new observations and variables to an existing dataset?</p></li>
<li><p><strong>(Compound):</strong> How to create a compound variable that represents both the gender and smoking status of an actuary?</p></li>
</ol>
<div id="task-1-removing-unimportant-variables" class="section level3" number="1.2.1">
<h3>
<span class="header-section-number">1.2.1</span> Task 1: Removing Unimportant Variables<a class="anchor" aria-label="anchor" href="#task-1-removing-unimportant-variables"><i class="fas fa-link"></i></a>
</h3>
<p>In the course of a data analysis, we may want to remove variables which turn out to be redundant or add little value to our analysis. In the <code>actuary</code> data, the <code>x</code> variable is a vector of row numbers that do not provide any useful information for understanding the eight actuaries.</p>
<p>To <strong>delete</strong> a variable in a data frame, we can use the <code>$</code> notation we learned to access the variable and assign it to the special symbol <code>NULL</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">actuary</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">actuary</span></span>
<span><span class="co">#&gt;              name gender age exams Q1 Q2 Q3 salary</span></span>
<span><span class="co">#&gt; 1      Embryo Luo      M  -1    10 10  9  9  3e+05</span></span>
<span><span class="co">#&gt; 2                      F  25     3 NA  9  7     NA</span></span>
<span><span class="co">#&gt; 3     Peter Smith      M  22     0  4  5  5  8e+04</span></span>
<span><span class="co">#&gt; 4            &lt;NA&gt;      F  50     4  7  7  8     NA</span></span>
<span><span class="co">#&gt; 5 Angela Peterson      F  30     6  8  8 10     NA</span></span>
<span><span class="co">#&gt; 6  Emily Johnston      F  42     7  9 10 10     NA</span></span>
<span><span class="co">#&gt; 7   Barbara Scott      ?  29     5  8  9  7     NA</span></span>
<span><span class="co">#&gt; 8    Benjamin Eng      M  36     9  7  8  8     NA</span></span></code></pre></div>
</div>
<div id="task-2-missing-values" class="section level3" number="1.2.2">
<h3>
<span class="header-section-number">1.2.2</span> Task 2: Missing Values<a class="anchor" aria-label="anchor" href="#task-2-missing-values"><i class="fas fa-link"></i></a>
</h3>
<p>In data analysis, we say that there is a <em>missing value</em> when a value is not available (hence missing) for a particular entry in a dataset for whatever reason.</p>
<p>In R, <strong>missing values</strong> are denoted by the special symbol <strong><code>NA</code></strong>, which stands for not available.</p>
<p>We can see that the actuary dataset has quite a few missing values:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Variable</th>
<th>Missing Value(s)</th>
<th></th>
<th></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>2nd and 4th observation</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>gender</code></td>
<td>7th observation</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>Q1</code></td>
<td>2nd observation</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>salary</code></td>
<td>All but the 1st and 3rd observation</td>
<td></td>
<td></td>
</tr>
</tbody>
</table></div>
<p><em>Note that although the name of the second observation is left blank (indicated by the empty character string ““) and the missing value of gender is coded as”?“, they are not treated technically in R as missing values. We will need to identify these entries manually.</em></p>
<p>Missing values are problmeatic in data analsis because many functions in R will return a missing value if some of its arguments contain missing values. There are many methods for dealing with missing values, some simple and some more sophisticated (the more sophisticated ones will e introduced in ATPA). In most cases, more than one method can apply. Here are some simple guidelines:</p>
<ul>
<li>
<strong><em>Removing observations:</em></strong> If the missing observations for a variable are only a very small part of the data, as in the case of Q1, then deleting the missing observation results in virtually no loss of information and is a sensible move.</li>
<li>
<strong><em>Removing variables:</em></strong> If the majority of the observation for a variable are missing ,as in the case of <code>salary</code>, then the variable contributes little information to help us understand the data and it makes sense to remove the entire variable.</li>
</ul>
<p>While removing observations nd/or variables is simple, doing so relies on the assumption that the missing values are randomly (rather than systematically) generated, so their removal is unlikely to introduce bias or impair the effectiveness of the predictive model we build.</p>
<p>For the sake of demonstration, here we will handle the missing values in the <code>actuary</code> dataset as follows:</p>
<ul>
<li>Removing the <code>salary</code> variable.</li>
<li>Removing the second and fourth rows.</li>
<li>Treating <code>gender</code> as a factor with three levels, <code>"M", "F", and "?"</code>. (This requires no adjustment. If you like, you can rename the “?” level as `“Unknown”.)</li>
</ul>
<p>The removal of <code>salary</code> should be straight forward and we can do it in exactly the same way as in Task 1.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">actuary</span><span class="op">$</span><span class="va">salary</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">actuary</span></span>
<span><span class="co">#&gt;              name gender age exams Q1 Q2 Q3</span></span>
<span><span class="co">#&gt; 1      Embryo Luo      M  -1    10 10  9  9</span></span>
<span><span class="co">#&gt; 2                      F  25     3 NA  9  7</span></span>
<span><span class="co">#&gt; 3     Peter Smith      M  22     0  4  5  5</span></span>
<span><span class="co">#&gt; 4            &lt;NA&gt;      F  50     4  7  7  8</span></span>
<span><span class="co">#&gt; 5 Angela Peterson      F  30     6  8  8 10</span></span>
<span><span class="co">#&gt; 6  Emily Johnston      F  42     7  9 10 10</span></span>
<span><span class="co">#&gt; 7   Barbara Scott      ?  29     5  8  9  7</span></span>
<span><span class="co">#&gt; 8    Benjamin Eng      M  36     9  7  8  8</span></span></code></pre></div>
<p>Now lets proceed to remove the second and fourth observations (rows). Here are two commond methods, both of which rely on logical subsetting:</p>
<ol style="list-style-type: decimal">
<li>
<em>Using the <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> function</em>: The <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> function returns an object of the same size as its argument. The elements of this object are equal to <code>TRUE</code> if the corresponding elements of the original object are equal to NA and equal to <code>FALSE</code> otherwise. Effectively, it answers the question of hether each element of the function’s argument is <code>NA</code> or not.</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">actuary</span><span class="op">$</span><span class="va">Q1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span><span class="va">actuary.1</span> <span class="op">&lt;-</span> <span class="va">actuary</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">actuary</span><span class="op">$</span><span class="va">Q1</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">actuary.1</span></span>
<span><span class="co">#&gt;              name gender age exams Q1 Q2 Q3</span></span>
<span><span class="co">#&gt; 1      Embryo Luo      M  -1    10 10  9  9</span></span>
<span><span class="co">#&gt; 3     Peter Smith      M  22     0  4  5  5</span></span>
<span><span class="co">#&gt; 4            &lt;NA&gt;      F  50     4  7  7  8</span></span>
<span><span class="co">#&gt; 5 Angela Peterson      F  30     6  8  8 10</span></span>
<span><span class="co">#&gt; 6  Emily Johnston      F  42     7  9 10 10</span></span>
<span><span class="co">#&gt; 7   Barbara Scott      ?  29     5  8  9  7</span></span>
<span><span class="co">#&gt; 8    Benjamin Eng      M  36     9  7  8  8</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>
<em>Using the <code><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases()</a></code> or <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> functions</em>: These two functions are more global than <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> and remove all rows containing missing values.</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">actuary</span><span class="op">)</span></span>
<span><span class="va">actuary.2</span> <span class="op">&lt;-</span> <span class="va">actuary</span><span class="op">[</span><span class="va">cc</span>, <span class="op">]</span></span>
<span><span class="va">actuary.2</span></span>
<span><span class="co">#&gt;              name gender age exams Q1 Q2 Q3</span></span>
<span><span class="co">#&gt; 1      Embryo Luo      M  -1    10 10  9  9</span></span>
<span><span class="co">#&gt; 3     Peter Smith      M  22     0  4  5  5</span></span>
<span><span class="co">#&gt; 5 Angela Peterson      F  30     6  8  8 10</span></span>
<span><span class="co">#&gt; 6  Emily Johnston      F  42     7  9 10 10</span></span>
<span><span class="co">#&gt; 7   Barbara Scott      ?  29     5  8  9  7</span></span>
<span><span class="co">#&gt; 8    Benjamin Eng      M  36     9  7  8  8</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">actuary.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">actuary</span><span class="op">)</span></span>
<span><span class="va">actuary.3</span></span>
<span><span class="co">#&gt;              name gender age exams Q1 Q2 Q3</span></span>
<span><span class="co">#&gt; 1      Embryo Luo      M  -1    10 10  9  9</span></span>
<span><span class="co">#&gt; 3     Peter Smith      M  22     0  4  5  5</span></span>
<span><span class="co">#&gt; 5 Angela Peterson      F  30     6  8  8 10</span></span>
<span><span class="co">#&gt; 6  Emily Johnston      F  42     7  9 10 10</span></span>
<span><span class="co">#&gt; 7   Barbara Scott      ?  29     5  8  9  7</span></span>
<span><span class="co">#&gt; 8    Benjamin Eng      M  36     9  7  8  8</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">actuary.n</span> <span class="op">&lt;-</span> <span class="va">actuary.3</span> <span class="co"># cleansed dataset</span></span>
<span><span class="va">actuary.n</span></span>
<span><span class="co">#&gt;              name gender age exams Q1 Q2 Q3</span></span>
<span><span class="co">#&gt; 1      Embryo Luo      M  -1    10 10  9  9</span></span>
<span><span class="co">#&gt; 3     Peter Smith      M  22     0  4  5  5</span></span>
<span><span class="co">#&gt; 5 Angela Peterson      F  30     6  8  8 10</span></span>
<span><span class="co">#&gt; 6  Emily Johnston      F  42     7  9 10 10</span></span>
<span><span class="co">#&gt; 7   Barbara Scott      ?  29     5  8  9  7</span></span>
<span><span class="co">#&gt; 8    Benjamin Eng      M  36     9  7  8  8</span></span>
<span></span>
<span><span class="co"># Number of rows with missing values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">actuary</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">actuary.n</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>While we have gotten rid of missing values, some entries in the new dataset are clearly amiss.</p>
<ul>
<li><p>First, the age of the first actuary, Embryo Luo, is -1, which is not possible and is likely the result of a data entry error.</p></li>
<li><p>Second, the actuary called Peter Smith has no exams passed. While this may not be an error, it is highly questionable – in this day and age, it is difficult to land a full-time actuarial job with no exams passed. In general, abormal values cannot be easily detected by built-in R functions and often have to be identified with the aid of human input.</p></li>
</ul>
<p>How should we deal with these two observations? Peter Smith is not as problematic since we are not completely sure whether his <code>exams</code> entry is an error or not. It is judicious to retain the entry, but discuss its potential inaccuracy in your response, if this was a real PA exam and you were asked to discuss any concerns with the data you might have.</p>
<p>The <code>age</code> entry of Embryo Luo is more troublesome. For now, we will keep it and proceed. However, if you are going to fit a predictive model using <code>age</code> as a predictor, then it makes sense to exclude Embryo Luo from your analysis or make an educated guess of his age, e.g., imput his age using the average age of the other actuaries.</p>
</div>
<div id="task-3-adding-new-variables" class="section level3" number="1.2.3">
<h3>
<span class="header-section-number">1.2.3</span> Task 3: Adding New Variables<a class="anchor" aria-label="anchor" href="#task-3-adding-new-variables"><i class="fas fa-link"></i></a>
</h3>
<p>The opposite of removing an existing variable (Task 1) is to create a new variable of interest, which may serve as predictors in a predictive model.</p>
<p>To add a new variable to a data frame, we can use the dollar sign <code>$</code> notation to name and define the new variable. The generic syntax is:</p>
<pre><code>DATA_FRAME$NEW_VARIABLE &lt;- DEFINITION</code></pre>
<p>Even if the new variable does not exist in the original data frame, R will automatically expland the data frame to accomodate the new variable.</p>
<p>As an illustration run the following code to create a new variable, called <code>S</code> and added to the <code>actuary.n</code> data, that measure the avaerage of the three evaluation ratings for each actuary.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">actuary.n</span><span class="op">$</span><span class="va">S</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">actuary.n</span><span class="op">$</span><span class="va">Q1</span> <span class="op">+</span> <span class="va">actuary.n</span><span class="op">$</span><span class="va">Q2</span> <span class="op">+</span> <span class="va">actuary.n</span><span class="op">$</span><span class="va">Q3</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span></span>
<span><span class="va">actuary.n</span></span>
<span><span class="co">#&gt;              name gender age exams Q1 Q2 Q3     S</span></span>
<span><span class="co">#&gt; 1      Embryo Luo      M  -1    10 10  9  9 9.333</span></span>
<span><span class="co">#&gt; 3     Peter Smith      M  22     0  4  5  5 4.667</span></span>
<span><span class="co">#&gt; 5 Angela Peterson      F  30     6  8  8 10 8.667</span></span>
<span><span class="co">#&gt; 6  Emily Johnston      F  42     7  9 10 10 9.667</span></span>
<span><span class="co">#&gt; 7   Barbara Scott      ?  29     5  8  9  7 8.000</span></span>
<span><span class="co">#&gt; 8    Benjamin Eng      M  36     9  7  8  8 7.667</span></span></code></pre></div>
<p>As in Task 1, it is crucial that we specify the name of the dataset that should host the new variable. If you drop <code>"actuary.n"</code> on the left and use the command:</p>
<pre><code>S &lt;- (actuary.n$Q1 + actuary.n$Q2 + actuary.n$Q3) / 3</code></pre>
<p>Then the new variable <code>S</code> will exist in the current workspace, but not as a new variable in the <code>actuary.n</code> data frame.</p>
<p>In the previous code, we manually averaged the three evaluation ratings for each actuary. However, it would be cumbersome to type the ratings variable one by one if there were more than three periods. In this case, the <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> function can make our work a lot easier and is a powerful function in general.</p>
<p>The <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> function allows us to “apply” an arbitrary function to any dimension of a matrix or a data frame, provided that its columns are of the same data structure. Its general syntax is:</p>
<p><span class="math display">\[
  \begin{equation}
  \boxed{\begin{align*}apply(DATA_FRAME, MARGIN, FUNCTION)\end{align*}}
  \end{equation}
  \]</span></p>
<p>where <code>MARGIN = 1</code> indciates that the function will act on the rows of the data frame, while <code>MARGIN = 2</code> indicates that the function will act on its columns.</p>
<p>The next code chunk calculates the means for Q1, Q2, and Q3 using the <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">actuary.n</span><span class="op">$</span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">actuary.n</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">actuary.n</span></span>
<span><span class="co">#&gt;              name gender age exams Q1 Q2 Q3     S</span></span>
<span><span class="co">#&gt; 1      Embryo Luo      M  -1    10 10  9  9 9.333</span></span>
<span><span class="co">#&gt; 3     Peter Smith      M  22     0  4  5  5 4.667</span></span>
<span><span class="co">#&gt; 5 Angela Peterson      F  30     6  8  8 10 8.667</span></span>
<span><span class="co">#&gt; 6  Emily Johnston      F  42     7  9 10 10 9.667</span></span>
<span><span class="co">#&gt; 7   Barbara Scott      ?  29     5  8  9  7 8.000</span></span>
<span><span class="co">#&gt; 8    Benjamin Eng      M  36     9  7  8  8 7.667</span></span></code></pre></div>
</div>
<div id="task-4-using-logical-tests-to-identify-observations-with-certain-characteristics" class="section level3" number="1.2.4">
<h3>
<span class="header-section-number">1.2.4</span> Task 4: Using Logical Tests to Identify Observations with Certain Characteristics<a class="anchor" aria-label="anchor" href="#task-4-using-logical-tests-to-identify-observations-with-certain-characteristics"><i class="fas fa-link"></i></a>
</h3>
<p>Under the SOA exam curriculum, an Associate is identified as an individual having passed seven to nine exams and a Fellow should have passed ten exams. To single out associates and fellows , we can again apply logical subsetting with carefully formulated logical tests. For a small dataset like <code>actuary.n</code>, it is easy to spot which actuaries are an associate or a fellow However, the subsetting techniques we introduce will generalize well to large datasets encounted in the practice; these datasets call for more systematic way to search through.</p>
<p>Fellows are easier to identify; they have passed exactly ten exams. Using this criterion to form a logical index vector for the row subscript, we can “extract” fellows and save their information to a new data frame called actuary.FSA:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">actuary.FSA</span> <span class="op">&lt;-</span> <span class="va">actuary.n</span><span class="op">[</span><span class="va">actuary.n</span><span class="op">$</span><span class="va">exams</span> <span class="op">==</span> <span class="fl">10</span>, <span class="op">]</span></span>
<span><span class="va">actuary.FSA</span></span>
<span><span class="co">#&gt;         name gender age exams Q1 Q2 Q3     S</span></span>
<span><span class="co">#&gt; 1 Embryo Luo      M  -1    10 10  9  9 9.333</span></span></code></pre></div>
<p>Similarly, for associates, we can subset on greater or equal to seven exams and less than or equal to 9 exams:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">actuary.ASA</span> <span class="op">&lt;-</span> <span class="va">actuary.n</span><span class="op">[</span><span class="va">actuary.n</span><span class="op">$</span><span class="va">exams</span> <span class="op">&gt;=</span> <span class="fl">7</span> <span class="op">&amp;</span> <span class="va">actuary.n</span><span class="op">$</span><span class="va">exams</span> <span class="op">&lt;=</span> <span class="fl">9</span>, <span class="op">]</span></span>
<span><span class="va">actuary.ASA</span></span>
<span><span class="co">#&gt;             name gender age exams Q1 Q2 Q3     S</span></span>
<span><span class="co">#&gt; 6 Emily Johnston      F  42     7  9 10 10 9.667</span></span>
<span><span class="co">#&gt; 8   Benjamin Eng      M  36     9  7  8  8 7.667</span></span></code></pre></div>
</div>
<div id="end-of-chapter-1-practice-problems" class="section level3" number="1.2.5">
<h3>
<span class="header-section-number">1.2.5</span> End of Chapter 1 Practice Problems<a class="anchor" aria-label="anchor" href="#end-of-chapter-1-practice-problems"><i class="fas fa-link"></i></a>
</h3>
<div id="exercise-1.5.2-writing-a-function-to-calculate-loglikelihood" class="section level4" number="1.2.5.1">
<h4>
<span class="header-section-number">1.2.5.1</span> Exercise 1.5.2: Writing a Function to Calculate Loglikelihood<a class="anchor" aria-label="anchor" href="#exercise-1.5.2-writing-a-function-to-calculate-loglikelihood"><i class="fas fa-link"></i></a>
</h4>
<p>For <span class="math inline">\(i = 1, ..., n\)</span>, let <span class="math inline">\(Y_{i}\)</span> be a Poisson random variable with mean <span class="math inline">\(\mu_{i}\)</span> and fitted mean <span class="math inline">\(\widehat{\mu}_{i}\)</span> based on a given predictive model (e.g., Poisson regression model, to be studied in Chapter 4) and the method of maximum likelihood estimation.</p>
<p><strong>(a)</strong> Show that the maximum loglikelihood function is:</p>
<p><span class="math inline">\(\boxed{l(\widehat{\mu}_{1},...,\widehat{\mu}_{n}) = {\sum_{n=1}^{n}\widehat{\mu}_{i}} +  constants}\)</span></p>
<p>provided that the <span class="math inline">\(\widehat{\mu}_{i}\)</span>’s are well-defined.</p>
<p><strong>(b)</strong> Write an R function called LL to compute the maximum loglikelihood function that takes the following two arguments:</p>
<ul>
<li>
<code>observed</code> is a vector of observed values of the <span class="math inline">\(Y_{i}\)</span>’s</li>
<li>`predicted’ is a vector of fitted values of the <span class="math inline">\(Y_{i}\)</span>’s</li>
</ul>
<p><strong>(c)</strong> Use the function in part (b) to calculate the maximized loglikelihood function for the following data:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span>, <span class="fl">12</span>, <span class="fl">15</span><span class="op">)</span> </span>
<span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.516332</span>, <span class="fl">2.516332</span>, <span class="fl">7.451633</span>, <span class="fl">7.451633</span>, <span class="fl">7.451633</span>, <span class="fl">7.451633</span>, <span class="fl">12.386934</span>, <span class="fl">12.386934</span>, <span class="fl">12.386934</span><span class="op">)</span></span></code></pre></div>
<p><em><strong>Solution:</strong></em></p>
<p><strong>(a)</strong> The log-likelihood function is:</p>
<p><span class="math display">\[
  \boxed{
  \begin{equation}
  L(\mu_{1}, ..., \mu_{n}) \propto {\prod_{i=1}^{n}e^{-\mu_{i}}\mu_{i}^{y_{i}}} = e^{-\sum_{i=1}^{n}\mu_{i}}\prod_{i=1}^{n}\mu_{i}^{y_{i}},
  \end{equation}
  }
  \]</span></p>
<p>so the log-likelihood function at the fitted means <span class="math inline">\(\widehat{\mu}_{1}, ..., \widehat{\mu}_{n}\)</span> is:</p>
<p><span class="math display">\[
  \boxed{
  \begin{equation}
  l(\mu_{1}, ..., \mu_{n}) = LnL(\widehat{\mu}_{1}, ..., \widehat{\mu}_{n}) = \sum_{i=1}^{n}y_{i}ln\widehat{\mu}_{i} - \sum_{i=1}^{n}\widehat{\mu}_{i} + constants
  \end{equation}
  }
  \]</span>
<strong>(b)</strong> The log-likelihood function involves <span class="math inline">\(ln\widehat{\mu}_{i}\)</span>, which is not defined when <span class="math inline">\(\widehat{\mu}_{i} \le 0\)</span>. To sidestep the calculation of <span class="math inline">\(ln\widehat{\mu}_{i}\)</span> for non-positive <span class="math inline">\(\widehat{\mu}_{i}\)</span>, we need to design the function in such a way that those <span class="math inline">\(\widehat{\mu}_{i}\)</span>’s will be converted to a small number such as 0.000001 and <span class="math inline">\(ln0.000001\)</span> is computed instead. This is accomplished by the <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> construct. Here is how the function is defined:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">observed</span>, <span class="va">predicted</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">predicted_pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">predicted</span> <span class="op">&lt;=</span> <span class="fl">0</span>, <span class="fl">0.000001</span>, <span class="va">predicted</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">observed</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">predicted_pos</span><span class="op">)</span> <span class="op">-</span> <span class="va">predicted</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>(c)</strong> For the given <code>observed</code> and <code>predicted</code> vectors, the maximized log-likelihood function equals 85.98277.</p>
<pre><code>``` r
observed &lt;- c(2, 3, 6, 7, 8, 9, 10, 12, 15) 
predicted &lt;- c(2.516332, 2.516332, 7.451633, 7.451633, 7.451633, 7.451633, 12.386934, 12.386934, 12.386934)

LL(observed, predicted)
#&gt; [1] 85.98
```</code></pre>
</div>
<div id="exercise-1.5.3-based-on-new-performance-measure-how-to-create-a-new-categorical-variable-that-classifies-each-actuary-as-excellent-good-unsatisfactory" class="section level4" number="1.2.5.2">
<h4>
<span class="header-section-number">1.2.5.2</span> Exercise 1.5.3 (Based on new performance measure, how to create a new categorical variable that classifies each actuary as “Excellent”, “Good”, “Unsatisfactory”)<a class="anchor" aria-label="anchor" href="#exercise-1.5.3-based-on-new-performance-measure-how-to-create-a-new-categorical-variable-that-classifies-each-actuary-as-excellent-good-unsatisfactory"><i class="fas fa-link"></i></a>
</h4>
<p>Consider the <code>actuary.n</code> dataset in Section 1.3. If needed, run the following code to get it set up again:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span></span>
<span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Embryo Luo"</span>, <span class="st">""</span>, <span class="st">"Peter Smith"</span>, <span class="cn">NA</span>, <span class="st">"Angela Peterson"</span>, <span class="st">"Emily Johnston"</span>, <span class="st">"Barbara Scott"</span>, <span class="st">"Benjamin Eng"</span><span class="op">)</span></span>
<span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"F"</span>, <span class="st">"F"</span>, <span class="st">"?"</span>, <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">25</span>, <span class="fl">22</span>, <span class="fl">50</span>, <span class="fl">30</span>, <span class="fl">42</span>, <span class="fl">29</span>, <span class="fl">36</span><span class="op">)</span></span>
<span><span class="va">exams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">Q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="cn">NA</span>, <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">8</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">Q2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">9</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">9</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">Q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span> ,<span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#salary &lt;- c(300000, NA, 80000, NA, NA, NA, NA, NA)</span></span>
<span><span class="va">actuary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span>, <span class="va">gender</span>, <span class="va">age</span>, <span class="va">exams</span>, <span class="va">Q1</span>, <span class="va">Q2</span>, <span class="va">Q3</span><span class="op">)</span></span>
<span><span class="va">actuary.n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">actuary</span><span class="op">)</span></span>
<span><span class="va">actuary.n</span><span class="op">$</span><span class="va">S</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">actuary.n</span><span class="op">$</span><span class="va">Q1</span> <span class="op">+</span> <span class="va">actuary.n</span><span class="op">$</span><span class="va">Q2</span> <span class="op">+</span> <span class="va">actuary.n</span><span class="op">$</span><span class="va">Q3</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span></span>
<span><span class="va">actuary.n</span></span>
<span><span class="co">#&gt;   x            name gender age exams Q1 Q2 Q3     S</span></span>
<span><span class="co">#&gt; 1 1      Embryo Luo      M  -1    10 10  9  9 9.333</span></span>
<span><span class="co">#&gt; 3 3     Peter Smith      M  22     0  4  5  5 4.667</span></span>
<span><span class="co">#&gt; 5 5 Angela Peterson      F  30     6  8  8 10 8.667</span></span>
<span><span class="co">#&gt; 6 6  Emily Johnston      F  42     7  9 10 10 9.667</span></span>
<span><span class="co">#&gt; 7 7   Barbara Scott      ?  29     5  8  9  7 8.000</span></span>
<span><span class="co">#&gt; 8 8    Benjamin Eng      M  36     9  7  8  8 7.667</span></span></code></pre></div>
<p>Suppose that as the boss of the six actuaries, you would like to classify them according to the following scheme:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Criterion</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>S &lt;= 7</td>
</tr>
<tr class="even">
<td>7 &lt; S &lt;= 9</td>
</tr>
<tr class="odd">
<td>S &gt;= 9</td>
</tr>
</tbody>
</table></div>
<p>Write R commands to perform these classifications and save the classifications as a new variable called <code>classify</code>.</p>
<p><strong><em>Solution:</em></strong> Similar to how we accomplished Task 4 (b) in Section 1.3, we use <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> to make the classifications:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">actuary.n</span><span class="op">$</span><span class="va">classify</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">actuary.n</span><span class="op">$</span><span class="va">S</span> <span class="op">&gt;=</span> <span class="fl">9</span>, <span class="st">"Excellent"</span>, </span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">actuary.n</span><span class="op">$</span><span class="va">S</span> <span class="op">&gt;</span> <span class="fl">7</span>, <span class="st">"Good"</span>, <span class="st">"Unsatisfactory"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">actuary.n</span></span>
<span><span class="co">#&gt;   x            name gender age exams Q1 Q2 Q3     S</span></span>
<span><span class="co">#&gt; 1 1      Embryo Luo      M  -1    10 10  9  9 9.333</span></span>
<span><span class="co">#&gt; 3 3     Peter Smith      M  22     0  4  5  5 4.667</span></span>
<span><span class="co">#&gt; 5 5 Angela Peterson      F  30     6  8  8 10 8.667</span></span>
<span><span class="co">#&gt; 6 6  Emily Johnston      F  42     7  9 10 10 9.667</span></span>
<span><span class="co">#&gt; 7 7   Barbara Scott      ?  29     5  8  9  7 8.000</span></span>
<span><span class="co">#&gt; 8 8    Benjamin Eng      M  36     9  7  8  8 7.667</span></span>
<span><span class="co">#&gt;         classify</span></span>
<span><span class="co">#&gt; 1      Excellent</span></span>
<span><span class="co">#&gt; 3 Unsatisfactory</span></span>
<span><span class="co">#&gt; 5           Good</span></span>
<span><span class="co">#&gt; 6      Excellent</span></span>
<span><span class="co">#&gt; 7           Good</span></span>
<span><span class="co">#&gt; 8           Good</span></span></code></pre></div>

</div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="introduction.html">Introduction</a></div>
<div class="next"><a href="data-exploration-and-visualization.html"><span class="header-section-number">2</span> Data Exploration and Visualization</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#basics-of-r-programming"><span class="header-section-number">1</span> Basics of R Programming</a></li>
<li>
<a class="nav-link" href="#data-types-in-r"><span class="header-section-number">1.1</span> Data Types in R</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#exercise-1.2.2---calculating-least-squares-estimates-by-matrix-manipulation"><span class="header-section-number">1.1.1</span> Exercise 1.2.2 - Calculating least squares estimates by matrix manipulation</a></li>
<li><a class="nav-link" href="#data-frames"><span class="header-section-number">1.1.2</span> Data Frames</a></li>
<li><a class="nav-link" href="#exercise-1.2.3---listing-the-components-of-a-list"><span class="header-section-number">1.1.3</span> Exercise 1.2.3 - Listing the components of a list</a></li>
<li><a class="nav-link" href="#functions"><span class="header-section-number">1.1.4</span> Functions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#basic-data-management"><span class="header-section-number">1.2</span> Basic Data Management</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#task-1-removing-unimportant-variables"><span class="header-section-number">1.2.1</span> Task 1: Removing Unimportant Variables</a></li>
<li><a class="nav-link" href="#task-2-missing-values"><span class="header-section-number">1.2.2</span> Task 2: Missing Values</a></li>
<li><a class="nav-link" href="#task-3-adding-new-variables"><span class="header-section-number">1.2.3</span> Task 3: Adding New Variables</a></li>
<li><a class="nav-link" href="#task-4-using-logical-tests-to-identify-observations-with-certain-characteristics"><span class="header-section-number">1.2.4</span> Task 4: Using Logical Tests to Identify Observations with Certain Characteristics</a></li>
<li><a class="nav-link" href="#end-of-chapter-1-practice-problems"><span class="header-section-number">1.2.5</span> End of Chapter 1 Practice Problems</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Society of Actuaries Exam PA</strong>" was written by Jeff A. Maxey. It was last built on 2024-10-05.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
